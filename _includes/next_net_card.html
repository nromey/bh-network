{%- assign payload = site.data.next_net -%}
{%- if jekyll.environment == 'development' -%}
  {%- assign json_src = "/.netlify/functions/proxy-next-nets" -%}
{%- else -%}
  {%- assign json_src = "https://data.blindhams.network/next_nets.json" -%}
{%- endif -%}
{%- assign heading_id = include.heading_id | default: "next-net-heading" -%}
{%- assign title = include.title | default: "Up Next on the Blind Hams Bridge" -%}
<section class="next-net-card-block" aria-labelledby="{{ heading_id }}" data-next-net-json="{{ json_src }}"
  data-tz-show-abbr="{%- if site.time_labels.show_abbr == false or site.time_labels.show_abbr == 'false' -%}false{%- elsif site.time_labels.show_abbr == true or site.time_labels.show_abbr == 'true' -%}true{%- else -%}true{%- endif -%}"
  data-tz-show-label="{%- if site.time_labels.show_label == false or site.time_labels.show_label == 'false' -%}false{%- elsif site.time_labels.show_label == true or site.time_labels.show_label == 'true' -%}true{%- else -%}true{%- endif -%}">
  <h2 id="{{ heading_id }}">{{ title }}</h2>
  <article class="next-net-card" aria-labelledby="{{ heading_id }}-title">
    <h3 id="{{ heading_id }}-title">{%- if payload and payload.next_net -%}{{ payload.next_net.name }}{%- else -%}Loading next net…{%- endif -%}</h3>
    <p class="next-net-meta">
      <span class="next-net-label">When</span>
      <time datetime="{%- if payload and payload.next_net -%}{{ payload.next_net.start_local_iso }}{%- endif -%}">{%- if payload and payload.next_net -%}{{ payload.next_net.start_local_iso | date: "%A, %B %-d, %Y at %-I:%M %p" }}{%- else -%}Fetching…{%- endif -%}</time>
      <span class="next-net-tz">{%- if payload and payload.next_net -%}{{ payload.next_net.time_zone
        | replace: "America/New_York", "Eastern"
        | replace: "America/Los_Angeles", "Pacific"
        | replace: "America/Chicago", "Central"
        | replace: "America/Denver", "Mountain" }}{%- else -%}—{%- endif -%}</span>
      {%- if payload and payload.next_net and payload.next_net.duration_min -%}
      <span class="next-net-duration">· {{ payload.next_net.duration_min }} min</span>
      {%- endif -%}
    </p>
    <h4>What to expect</h4>
    <p>{%- if payload and payload.next_net -%}{{ payload.next_net.description }}{%- else -%}We’ll load details momentarily.{%- endif -%}</p>
  </article>
</section>
<script>
  // Expose descriptions from `_data/nets.json` for client hydration (used by the card)
  (function(){
    try {
      var map = {
        {%- assign first = true -%}
        {%- for n in site.data.nets.nets -%}
          {%- if n.description and n.id -%}
            {%- if first -%}{%- assign first = false -%}{%- else -%},{%- endif -%}
            {{ n.id | jsonify }}: {{ n.description | markdownify | replace: "<p>", "" | replace: "</p>", "" | strip | jsonify }}
          {%- endif -%}
        {%- endfor -%}
      };
      window.BHN_NET_META = window.BHN_NET_META || {};
      window.BHN_NET_META.descriptions = Object.assign({}, window.BHN_NET_META.descriptions || {}, map);
    } catch (e) {}
  })();
  </script>
<script defer src="{{ '/assets/js/json-widgets.js' | relative_url }}?v={{ site.github.build_revision | default: site.time | date: '%s' }}"></script>
