{%- comment -%} _includes/head.html {%- endcomment -%}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

{%- assign __title_base = page.title | default: site.title -%}
{%- assign __suffix = '' -%}
{%- if page.layout == 'post' -%}
  {%- assign __suffix = ' — News' -%}
{%- endif -%}
{%- if page.categories and page.categories contains 'cqbh' -%}
  {%- assign __suffix = __suffix | append: ' — CQ Blind Hams' -%}
{%- endif -%}
{%- if site.title -%}
  <title>{{ __title_base }}{{ __suffix }} | {{ site.title }}</title>
{%- else -%}
  <title>{{ __title_base }}{{ __suffix }}</title>
{%- endif -%}

{%- assign __desc = page.excerpt | default: page.description | default: site.description -%}
{%- if __desc -%}
  <meta name="description" content="{{ __desc | strip_html | strip_newlines | truncate: 300 }}">
{%- endif -%}

{%- if site.plugins contains "jekyll-seo-tag" -%}
  {%- seo -%}
{%- endif -%}

{%- assign bust = site.github.build_revision | default: site.time | date: '%s' -%}

<!-- Your styles (order matters: base first, page-specific later) -->
<link rel="stylesheet" href="{{ '/assets/css/site.css'  | relative_url }}?v={{ bust }}">
<link rel="stylesheet" href="{{ '/assets/css/extra.css' | relative_url }}?v={{ bust }}">
<link rel="stylesheet" href="{{ '/assets/css/nets.css'  | relative_url }}?v={{ bust }}">

{%- if page.extra_css -%}
<link rel="stylesheet" href="{{ page.extra_css | relative_url }}?v={{ bust }}">
{%- endif -%}

{%- if page.ableplayer -%}
  <!-- Able Player assets (only when page.ableplayer: true). CDN-first with local fallback. -->
  <!-- CSS: CDN-first -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ableplayer/ableplayer@v4.7.0/build/ableplayer.min.css">
  <!-- Local CSS fallback (non-blocking) -->
  <link rel="stylesheet" href="{{ '/assets/vendor/ableplayer/ableplayer.min.css' | relative_url }}?v={{ bust }}" media="print" onload="this.media='all'">

  <!-- JS dependencies: js-cookie, jQuery, AblePlayer (CDN-first with local fallback) -->
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
          onerror="this.onerror=null; this.src='{{ '/assets/vendor/jquery/jquery-3.7.1.min.js' | relative_url }}?v={{ bust }}';"></script>
  <script src="https://cdn.jsdelivr.net/gh/ableplayer/ableplayer@v4.7.0/build/ableplayer.min.js"
          onerror="this.onerror=null; this.src='{{ '/assets/vendor/ableplayer/ableplayer.min.js' | relative_url }}?v={{ bust }}';"></script>

  <!-- Defensive init + diagnostics -->
  <script src="{{ '/assets/js/able-init.js' | relative_url }}?v={{ bust }}"></script>
  <script>
    // Minimal diagnostics: if Able Player doesn't initialize, emit a console warning once.
    (function(){
      function diag(){
        try {
          var anyMedia = document.querySelector('audio[data-able-player],video[data-able-player]');
          var anyAble = document.querySelector('.able-wrapper');
          if (anyMedia && !anyAble) {
            if (typeof AblePlayer === 'undefined') {
              console.warn('[AblePlayer] Scripts present but AblePlayer is undefined. Check CSP or blocked CDN.');
            } else {
              console.warn('[AblePlayer] Found media with data-able-player but no upgraded player.');
            }
          }
        } catch(e) {}
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', diag);
      else diag();
    })();
  </script>
{%- endif -%}

{%- if site.favicon -%}
<link rel="icon" href="{{ site.favicon | relative_url }}">
{%- endif -%}
